{% extends 'LVR/base.html' %}
{% load static %}
{% load i18n %}
{% load crispy_forms_tags %} 



{% block og_type %}article{% endblock %}
{% block og_title %}{{post.title|truncatewords:30}}{% endblock %}
{% block og_desc %}{{ post.subtitle|truncatewords:25}}{% endblock %}
{% block og_image %}{{post.image.url}}{% endblock %}
{% block og_url %}{% endblock %}
{% block title %} {{post.title}} | Le vÃ©lo rouge {% endblock %}




{% block javascript_captcha %}
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
{% endblock %}



{% block post_content %}


<!-- <div class="px-2 px-md-3 px-lg-5 mx-2 mx-md-3 mx-lg-5"> -->
<div class="container-fluid px-lg-5 pb-5">
    <div class="px-lg-5">
        <div itemscope itemtype="https://schema.org/BlogPosting">
            <div class="row my-3 py-5 px-0 px-sm-0">
                <div class="col-lg-8 ">
                    <div class="card shadow">
                        <div class="mx-2 mx-md-3 mx-lg-3">
                            <div class="card-body">
                                <div class="post-header mt-3">
                                    {% if request.user == post.author.name %}
                                    <div class="alert {% if post.status == 0 %}alert-warning{% endif %}{% if post.status == 1 %}alert-success{% endif %}{% if post.status == 2 %}alert-danger{% endif %}{% if post.status == 3 %}alert-dark{% endif %}">                                    
                                        <div class="row d-flex justify-content-center justify-content-lg-between align-items-center">
                                            <div class="col-12 col-lg-9 pr-0">
                                                <div class="text-center text-lg-left py-2" style="font-size: 14px;">
                                                    <b>
                                                        {% if post.status == 0 %}{% trans 'post_draftStatus' %}{% endif %}
                                                        {% if post.status == 1 %}{% trans 'post_approvedStatus' %} ðŸŽ‰{% endif %}
                                                        {% if post.status == 2 %}{% trans 'post_rejectedStatus' %}{% endif %}
                                                        {% if post.status == 3 %}{% trans 'post_draftStatus' %}{% endif %}
                                                        {% if post.status == 4 %}{% trans 'post_archivedStatus' %}{% endif %}
                                                    </b>
                                                    <!-- <b> Este post esta publicado y acetparo, lo que significa que todos lo pueden ver, hurra!</b>ðŸŽ‰ -->
                                                </div>
                                            </div>
                                            
                                            <div class="col-12 col-lg-3 pl-4 text-center">
                                                <div class="col-fluid text-center">
                                                    {% if post.status == 1 %}
                                                    <div data-toggle="tooltip" data-html="true" data-placement='top' title="{% trans 'post_alreadyApprovedMsg' %}">
                                                        <a class="btn btn-dark" href="{% url 'post_edit' post.slug %}"><i class="material-icons align-top">edit</i> Editar post </a>
                                                    </div>
                                                    {% else %}
                                                    <a class="btn btn-dark" href="{% url 'post_edit' post.slug %}"><i class="material-icons align-top">edit</i> Editar post </a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %} 
    
    
    
                                    <div class="row">
                                        <div class="col-12">
                                            <div itemprop="headline"> <h2 class="text-center text-lg-left font-weight-bold"> {{ post.title }} </h2> </div> 
                                        </div>
                                        <div class="col-12">
                                            <div itemprop="alternativeHeadline"> <p class="text-center text-lg-left py-3 h4"> {{ post.subtitle }} </p> </div>
                                        </div>                                  
                                    </div>
    
                                    
                                    
                                    
                                   
                                    
                              
                                    
                                    
                                    
                                </div>
    
                                <hr>
                                <img itemprop="image" class="img-detail img-fluid rounded" src="{{ post.image.url }}" alt="{{post.title}}"> 
                                <hr>
    
                                <div itemprop="text"> <p class="py-1"> {{ post.post_body|safe}} </p> </div>
                                <hr>
                                <div class="row d-flex d-inline py-3 justify-content-center">
                                    <button type="button" class="btn btn-secondary mx-2"> <i class="material-icons align-top">grade</i> {% trans 'favReaction' %} <span class="badge badge-light">9</span> </button>
                                    <button type="button" class="btn btn-info mx-2"> <i class="material-icons align-top">done</i> {% trans 'utilReaction' %} <span class="badge badge-light">9</span> </button>
                                    <button type="button" class="btn btn-success mx-2"> <i class="material-icons align-top">thumb_up</i> {% trans 'goodReaction' %} <span class="badge badge-light">9</span> </button>
                                    <button type="button" class="btn btn-danger mx-2"> <i class="material-icons align-top">thumb_down</i> {% trans 'badReaction' %} <span class="badge badge-light">9</span> </button>
                                </div>
    
                                <div class="row py-3 my-1 align-middle text-center ">
                                    <div class="col-12">
                                        <div itemprop="keywords"> 
                                            <h6 class="lead mx-2 d-inline-block align-middle"> Temas: </h6>
                                            {% if post.category %}
                                            <a class="h6 badge badge-pill bg-steel text-white reset-anchor-inherit px-2" href="{% url 'categories_detail' post.category.slug %}"> 
                                                {{ post.category }}
                                            </a>
                                            {% else %}
                                            <h6 class="lead mx-2 d-inline-block align-middle"> Al parecer este post no pertenece a ninguna categorÃ­a. </h6>
                                            {% endif %}
                                            
                                            
                                            {% if post.tags.all %}
                                            {% for tag in post.tags.all %}
                                            <a class=" h6 badge badge-pill badge-dark text-white reset-anchor-inherit px-2 my-2 mx-1" href="{% url 'tags_detail' tag.slug %}"> 
                                                <i class="fas fa-tag fa-sm mx-1"></i>{{ tag }}
                                            </a>
                                            {% endfor %}
                                            {% else %}
                                            <h6 class="lead mx-2 d-inline-block align-middle"> No hay tags relacionados con este post. </h6>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div> 
    
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4 ">
                    <div class="card mt-4 mt-lg-0 mt-xl-0 ">
                        <div class="card-body">
                            <h6 itemprop="dateCreated"> <small> {% trans 'post_detail_PublishedDate' %}: {% if post.published_date %} {{ post.published_date }} {% endif %} </small></h6>
                            <div itemprop="creator">
                                <div class="row mt-3 mb-1 ">
                                    <div class="col-xs-6 col-sm-3 col-md-2 col-lg-4" >
                                        <div class="author " style="padding-left: 1px;">
                                            <a href="{% url 'author_detail' post.author.slug %}">
                                                <img class="circle-rounded" src="{{ post.author.image.url }}" alt="{{post.author.name.get_full_name}}" width="100">
                                            </a>
                                        </div>
                                    </div>
                                    
                                    <div class="col-xs-6 col-sm-9 col-md-10 col-lg-8">
                                        <div class="row">
                                            
                                            <div class="column detailsAuthor" >
                                                <h6 class="mt-3"> {% trans 'PostBy' %}:  
                                                    <a href="{% url 'author_detail' post.author.slug %}" itemscope itemtype="http://schema.org/Person"> {{ post.author.name.get_full_name }}</a>  
                                                </h6>
                                                
                                                <div itemprop="jobTitle"> <p> {{ post.author.title }} </p> </div>
                                                
                                            </div> 
                                            
                                        </div>
                                    </div> 
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    
                    <div class="card border-0 mt-3 shadow-sm mb-4 mb-lg-5 p-2 p-lg-0">
                        <div class="card-body p-lg-4">
                            <h4 class="h4 mb-4">Comparte o guarda este post</h4>
    
                             <!-- AddToAny BEGIN -->
                            <ul class="list-inline mb-0 a2a_kit a2a_kit_size_32 a2a_default_style">
                                <li class="list-inline-item"><a class="a2a_button_facebook"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_facebook_messenger"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_twitter"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_email"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_whatsapp"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_telegram"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_pinterest"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_evernote"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_pocket"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_reddit"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_tumblr"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_print"></a></li>
                                <li class="list-inline-item"><a class="a2a_button_copy_link"></a></li>
                                <li class="list-inline-item"><a class="a2a_dd" href="https://www.addtoany.com/share"></a></li>
                            </ul>
                            <script> var a2a_config = a2a_config || {}; a2a_config.onclick = 1; a2a_config.num_services = 10; </script>
                            <script async src="https://static.addtoany.com/menu/page.js"></script>
                            <!-- AddToAny END -->
    
    
                             
    
    
                            <!-- <ul class="list-inline mb-0">
                                <li class="list-inline-item"><a class="social-link facebook" href="#"><i class="fab fa-facebook-f fa-lg"></i></a></li>
                                <li class="list-inline-item"><a class="social-link twitter" href="#"><i class="fab fa-twitter fa-lg"></i></a></li>
                                <li class="list-inline-item"><a class="social-link vimeo" href="#"><i class="fab fa-vimeo"></i></a></li>
                                <li class="list-inline-item"><a class="social-link instagram" href="#"><i class="fab fa-instagram"></i></a></li>
                                <li class="list-inline-item"><a class="social-link youtube" href="#"><i class="fab fa-youtube"></i></a></li>
                            </ul> -->
    
    
                           
    
                        </div>
                    </div>
                    
                    <div class="card mt-3">
                        <div class="card-body bg-platinum">
                            <h4 class="h4 mb-2">Buscar</h4>
                            <hr class="mt-1 mb-3">
                            <div class="row">
                                <div class="col-lg-12 mx-0">
                                    <form method="GET" action="{% url 'search' %}" name="" class="mx-0 mb-2 rounded">
                                        <label class="col bg-platinum p-0 pt-1 text-left ml-1 par" for="search_input">{{searchForm.q.label}}</label>
                                        <div class="bg-white p-2 rounded">
                                            <div class="input-group">
                                                {{searchForm.q}}
                                                <div class="input-group-append rounded">
                                                    <button class="btn btn-primary rounded" type="submit"><i class="fas fa-search"></i></button>
                                                </div>
                                            </div>
                                        </div>                                    
                                    </form>                         
                                </div>
                            </div>
                        </div>
                    </div>                
                    
                    {% if post.status == 1 %}
                    <div class="mt-3 mt-lg-5">
                        <div id="accordion">
                            <div class="card">
                                <div class="card-header" id="more_from">
                                    <h5 class="mb-0">
                                        <button class="btn btn-link" data-toggle="collapse" data-target="#collapse_mf" aria-expanded="true" aria-controls="collapseTwo">
                                            <i class="material-icons align-top">keyboard_arrow_down</i> {% trans 'post_detail_MoreFrom' %} {{ post.author.name.get_full_name }}
                                        </button>
                                    </h5>
                                </div>
                                <div id="collapse_mf" class="collapse" aria-labelledby="more_from" data-parent="#accordion">
                                    <div class="card-body">
                                        {% for rpost in more_from_author %} <!-- Getting the latest 4 blogs from author, rpost means related post -->  
                                        {% if rpost %}  <!-- If there're another post related to this author -->
                                        {% if rpost.title != post.title  %}  <!-- Filtering the 4 latest posts, if the current post_detail is inside the latest 4 we don't want it -->
                                        <div class="py-2 mx-1">
                                            <div class="card">
                                                <div class="img-post-small img-zoom">    
                                                    <a href="{% url 'post_detail' rpost.category rpost.slug %}"> <img class="card-img-top" src="{{ rpost.image.url }}" alt="{{ rpost.title }}"> </a>
                                                </div>
                                                <div class="card-body">
                                                    <h6 class="post-subtitle"><a href=" {% url 'post_detail' rpost.category rpost.slug %} "> {{ rpost.title }} </a></h6>         
                                                    <p class="mt-2 card-subtitle text-muted ">Publicado: {{ rpost.published_date }} </p>
                                                </div>
                                            </div>  
                                        </div>
                                        {% endif %} 
                                        {% else %} <!-- If the object 'more_from_author' returns a single object, and that object (a post) has a title that's equal to the current post title, that means ther're only one post written by the author -->
                                        <h5> {% trans 'post_detail_NoMorePosts' %} </h5>
                                        {% endif %}   
                                        {% endfor %}    
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                </div>
                
            </div>
        </div>


        {% if related_posts %}
        <section class="mb-0 mb-sm-5 mb-md-5 mb-lg-5 mb-xl-5">
            <div class="container pb-5">
                <header class="text-center mb-5">
                    <h1 class="mt-3 py-3 font-weight-bold"> {% trans 'mayInterested' %} </h1> 
                </header>
                <div class="row justify-content-center">
                    {% for post in related_posts%}
                    <div class="col-lg-4 mb-2 pb-4">
                        <div itemscope itemtype="https://schema.org/BlogPosting">
                            <div class="card shadow-sm border-0 reset-anchor d-block">
                                <div class="tool-thumb rounded-circle">
                                    <a href="{% url 'categories_detail' post.category.slug %}" class="img-zoom">
                                      <img class="img-fluid rounded-circle" src="{{post.category.image.url}}" alt="{{post.category}}" width="40">
                                    </a>
                                </div> 
                                <a class="d-block dark-overlay card-img-top overflow-hidden tool-trending" href="{% url 'post_detail' post.category post.slug %}">
                                <div class="watched-badge text-shadow mx-auto" rel="tooltip" data-placement="top" title="Featured"> <i class="fas fa-eye"></i> +100K </div>
                                <div class="cmts-badge text-shadow mx-auto" rel="tooltip" data-placement="top" title="Featured"> <i class="fas fa-comments"></i> 999 </div>
                                <div class="overlay-content"><img class="img-fluid" src="{{post.image.url}}" alt="{{post.title}}"></div>
                                <div class="card-body pt-4 pb-3 px-4">
                                    <h3 class="h5 post-title"> <a class="stretched-link" href="{% url 'post_detail' post.category post.slug %}">{{post.title}}</a></h3>
                                    <h6 itemprop="alternativeHeadline" class="post-subtitle mt-1 mb-3"> {{ post.subtitle }} </h6>
                                    
                                    <p class="text-preview text-small mb-0"> {{post.post_body|safe|truncatewords:30}}</p>
                                    <hr>
                                    <div class="py-0 my-0">
                                        <p itemprop="dateCreated" class="mt-2 card-subtitle text-muted ">Publicado: {{ post.published_date }} </p>
                                        <h6 itemprop="creator" class="mt-1 post-author"> {% trans 'PostBy' %}: <a href="{% url 'author_detail' post.author.slug %}"> {{ post.author.name.get_full_name }} </a> </h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
                    {% endfor %}
                </div>
            </div>
        </section>
        {% endif %}
        
        
        {% if post.status == 1 %}
        <div class="pb-5">
            <div class="card shadow-sm p-2 p-lg-0">
                <div class="card-body">
            
                    <h3 class="py-1 mb-3"> <b> {{ comments.count }} </b> {% trans 'post_detail_CountingComments' %} </h3>
                    <a id="new_cmt_btn" class="my-2 mb-4 btn btn-secondary" href="#newCmt" role="button" data-toggle="collapse" aria-expanded="false" aria-control="newCmt">Escribe un comentario</a>
                    <div id="new_cmt_success" style="display:none;" class="alert alert-success" role="alert"> {% trans 'post_detail_AwaitingModeration' %} </div>
                    <div class="collapse" id="newCmt">
                        <div class="py-3">
                            <form id="new_comment" method="POST">
                                {% csrf_token %}
            
                                <div class="row">
                                    <div class="form-group col-6">
                                        <label class="ml-1" for="comment_fullName">{{commntForm.author.label}}</label>
                                        {{commntForm.author}}
                                    </div>
                
                                    <div class="form-group col-6">
                                        <label class="ml-1" for="comment_email">{{commntForm.author_email.label}}</label>
                                        {{commntForm.author_email}}
                                    </div>
                
                                    <div class="form-group col-12">
                                        <label class="ml-1" for="comment_body">{{commntForm.comment_body.label}}</label>
                                        <small class="float-left float-sm-right float-md-right float-lg-right mx-2"> (AsegÃºrate que tu comentario siga las <a href="{% url 'comments_terms' %}"  target="_blank"> normas comunitarias</a>). </small>
                                        {{commntForm.comment_body}}
                                    </div>
            
                                    <div class="form-group col-12 m-0">
                                        <div class="g-recaptcha" data-sitekey="6Le7PK0ZAAAAAB35Ahoq-zY-OWb1y_4hBqiQEg3l"></div>
                                        <p id="new_cmt_errorCaptcha" style="display: none;" class="ml-1 mt-2 small h6 font-weight-bold text-danger"> <i class="fas fa-exclamation-circle"></i> Captcha incorrecto, intenta de nuevo</p>
            
                                        <button class="mt-3 btn btn-primary" type="submit">Comentar</button>
                                    </div>
                                    
            
                                </div>
                            </form> 
                        </div>
                    </div>
            
                    <hr class="mt-1 mb-4">
            
                    {% for comment in comments %}
                    <div class="cmt mt-3 mb-3" itemscope itemtype="https://schema.org/Comment"> 
                        <div class="row mx-3 d-flex justify-content-left justify-content-lg-between" >
                            <div class="col-10">
                                <div class="row d-flex justify-content-start">
                                    
                                    <div class="media align-items-center">
                                        <img class="rounded-circle" src="{% static 'LVR/assets/img/jeff.png' %}" alt="" width="75">
                                        <div class="media-body ml-3">
                                            <h5 class="mb-0 font-weight-bold">{{comment.author}}</h5>
                                            <p class="small text-muted mb-0 font-weight-bold">{{comment.created_date}}</p>
                                            <!-- <ul class="list-inline mb-0 small ">
                                                <li class="list-inline-item m-0"><i class="fas fa-star text-primary"></i></li>
                                                <li class="list-inline-item m-0"><i class="fas fa-star text-primary"></i></li>
                                                <li class="list-inline-item m-0"><i class="fas fa-star text-primary"></i></li>
                                                <li class="list-inline-item m-0"><i class="fas fa-star text-primary"></i></li>
                                                <li class="list-inline-item m-0"><i class="fas fa-star-half-alt text-primary"></i></li>
                                            </ul> -->
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="col-2">                            
                                <div class="row d-flex justify-content-end">
                                    {% if not comment.has_report %}
                                    <div class="" data-toggle="tooltip" data-html="true" data-placement='right' title="{% trans 'reportComment' %}">
                                        <p class=""> <a href="#"> <i class="material-icons align-top md-22">report_problem</i></a> </p>
                                    </div>
                                    {% else %}
                                    <div class="" data-toggle="tooltip" data-html="true" data-placement='right' title="{% trans 'reportedComment' %}">
                                        <p> <a href="#" class="text-danger"> <i class="material-icons align-top">info</i></a> </p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="cmt-body" itemprop="comment"> 
                            {% if not comment.has_report %}
                            {{ comment.comment_body | linebreaks }} 
                            {% else %}                          
                            <div>
                                <h3 class="mb-1">
                                    <button class="btn btn-link btn-sm" data-toggle="collapse" data-target="#collapse_reportedComment" aria-expanded="true" >
                                        <i class="material-icons align-top md-22 text-danger">keyboard_arrow_down</i> {% trans 'dashboard_Settings_SM_show' %} 
                                    </button>
                                </h3>
                                
                                <div id="collapse_reportedComment" class="collapse" aria-labelledby="reportedComment" >
                                    <div class="py-2 px-2">
                                        <div class="text-danger" style="text-decoration: line-through;">                                
                                            {{ comment.comment_body | linebreaks }} 
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}                        
                        </div> 
                    </div>
                    {% endfor %}      
            
                   
                </div>
            </div>
        </div>
        {% endif %}


    </div>

</div>


{% endblock %}