
{% extends 'LVR/user/base.html' %}
{% load static %}
{% load i18n %} 
{% load crispy_forms_tags %} 


{% block new_category %}


<div class="mt-3">
    
    <div class="row container d-flex justify-content-between mx-2">
        <div class="row">
            <h2 class="mt-2 font-weight-bold"> {% trans 'addNew_Category' %} </h2>
        </div>

        <div class="mt-2 mt-lg-3">
            <a href="{% url 'dashboard' %}">
                <button type="button" class="btn"> <i class="material-icons align-middle">arrow_back</i> {% trans 'goBack' %} </button>
            </a>
        </div>
    </div>
        
    <hr class="mt-3">

    <div class="row d-flex justify-content-center py-2 py-sm-3 py-md-3 py-lg-4 mb-4 mb-sm-3">
        <div class="col-lg-xs-12 col-lg-sm-12 col-lg-md-8 col-lg-5 col-lg-xl-6">
            <div class="card">
                <div class="card-body mt-1">

                    <p id="newCatego_form_success" style="display:none" class="py-2 small h6 font-weight-bold text-success text-center"> <i class="fas fa-check mr-1"></i>Categoría agregada</p>
                    <p id="newCatego_form_error" style="display:none" class="py-2 small h6 font-weight-bold text-danger text-center"> <i class="fas fa-exclamation-circle mr-1"></i>Error al agregar categoría</p>

                    <form id="newCatego_frm" method="POST" enctype="multipart/form-data">
                        {% csrf_token %}  
                        <div class="form-group py-1">
                            <label class="ml-1" for="post_title">{{newCategoryForm.name.label}}</label>
                            {{newCategoryForm.name}}
                        </div>
                        
                        <div class="form-group py-1">
                            <label class="ml-1" for="post_title">{{newCategoryForm.description.label}}</label>
                            {{newCategoryForm.description}}
                        </div>
                                                
                        <div class="form-group py-1"> 
                            <label class="ml-1" for="post_image">{{newCategoryForm.image.label}}</label>
                            <div class="img-upload"> 
                                {{ newCategoryForm.image }}  
                            </div>
                        </div>
                        
                        <div class="form-group"> <button type="submit" class="btn btn-primary btn-block"> {% trans 'addCatego_CTA' %} </button> </div>
                    </form>

                </div>
            </div>
        </div> 
    </div>





{% block js %}
<script>
    $(document).on('submit', '#newCatego_frm',function(e){
        $("#txt").remove();
        var data = new FormData($('#newCatego_frm').get(0));
        e.preventDefault();
        $.ajax({
            type: 'POST',
            url: "{% url 'new_category' %}",
            dataType: 'json',
            data: data,
            contentType: false,
            processData: false,
            success: function(json){
                if(json.success){     
                    document.getElementById("newCatego_frm").reset();
                    $('#newCatego_form_success').fadeIn(700).css({'display': 'block'}).delay(2000).fadeOut(700);
            }
            else if (json.err_code == 'already_exists'){
                $('#newCatego_form_error').append('<span id="txt">: ya existe esa categoría</span>');
                $('#newCatego_form_error').fadeIn(700).css({'display': 'block'}).delay(2000).fadeOut(700);
            }
            else { alert(json.err_code); }
        },
            error : function(xhr,errmsg,err) {
                console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
            }
        });
        return false;
    });
</script> 
{% endblock %}
    




</div> 


{% endblock %}